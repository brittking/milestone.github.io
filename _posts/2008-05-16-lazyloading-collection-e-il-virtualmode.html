---
layout: post
title: LazyLoading, collection e il VirtualMode
date: '2008-05-16T16:38:00.000+02:00'
author: Mauro Servienti
tags:
- Software Mason
modified_time: '2012-08-04T17:50:54.339+02:00'
blogger_id: tag:blogger.com,1999:blog-6511237790974218081.post-3389687964531394635
blogger_orig_url: http://milestone.topics.it/2008/05/lazyloading-collection-e-il-virtualmode.html
---

<span>Oggi sono blogorroico :-D, e quindi ci metto anche il terzo... se poi "il quattro vien da se" be allora siamo proprio alla frutta...</span><br>  <span>In questo caso parliamo di qualcosa che è ancora in una versione più che embrionale... è quasi tutto ancora nella mia testa... o meglio ben dettagliato sul fido OneNote.    <br>Il problema è questo:</span><br>  <span>IMyEntity entity = whatEverDataProvider.GetMyEntity();    <br>IMyCollection list = entity.Children;     <br>Int32 count = list.Count;     <br>    <br>if( count > 100 )     <br>{     <br>    foreach( var child in list )     <br>    {     <br>        //Do something with child     <br>    }     <br>}</span><br>  <span>e voi direte... ma dove sta il problema? sta sta... ;-) supponiamo che la collection "<em>Children</em>" sia caricata in modalità lazy e che, nell'esempio, contenga 90 elementi: bene stiamo caricando 90 "item" solo per fare un confronto con il Count di questi elementi. E giustamente voi potreste ribadire: si certo... bravo, fai un metodo GetCount() sul data provider...</span><br>  <span>IMyEntity entity = whatEverDataProvider.GetMyEntity();    <br>Int32 count = whatEverDataProvider.GetChildrenCount( entity );</span><br>  <span>...etc</span><br>  <span>+1 sono perfettamente d'accordo, ma lo sviluppatore è pigro e se trova una proprietà Count usa quella anche se le policy, le regole, gli accordi o le litigate dicono diversamente... quindi mi sono chiesto, pensando al deferred loading di linq, ma perchè non introdurre questo concetto in una collection custom? e quindi avere la collection istanziata, ma vuota e solo ed esclusivamente al primo tentativo di lettura, ad esempio un GetEnumerator(), caricare effettivamente i dati; se poi siamo veramente smart potremmo implementare delle logiche per ad esempio ritornare il solo "Count" all'atto della richiesta.</span><br>  <span>A questo punto la domanda sicuramente è: ma perchè ti vuoi fare del male da solo e non usi un ORM? me lo sono chiesto anche io... e mi sono risposto:</span><br>  <ol>   <li>Il cliente non ne vuole sapere. Si lo so non è una scusa valida ;-); </li>    <li>Il team in questo momento, compreso il sottoscritto, ha miseri skill su NH e il lavoro è già abbastanza complesso di suo senza introdurre altre problematiche; </li>    <li>Abbiamo requisiti che la "<a href="http://blogs.ugidotnet.org/pape" target="_blank">mia fonte</a>" dice non essere esaudibili con NH; </li>    <li>varie ed eventuali...; </li> </ol>  <span>.m</span><br>  