---
layout: post
title: 'Report: “ResetPageNumberAfter”'
date: '2009-07-17T17:44:00.000+02:00'
author: Mauro Servienti
tags:
- Software Mason
modified_time: '2012-02-02T12:16:35.154+01:00'
thumbnail: https://lh6.googleusercontent.com/-OQ4_Xj_efxs/TypweHbTerI/AAAAAAAAAkQ/uudTiCD52eY/s72-c/image_thumb.png
blogger_id: tag:blogger.com,1999:blog-6511237790974218081.post-8336103270112776356
blogger_orig_url: http://milestone.topics.it/2009/07/report-resetpagenumberafter.html
permalink: /2009/07/report-resetpagenumberafter.html
---

<span>Una delle cose che gli utenti chiedono è di poter selezionare in blocco un set di dati e stamparli, un esempio banale è questa window per la ricerca di contratti in cui l’utente seleziona uno o più contratti e poi può pigiare il bottone stampa presente nella Quick Access Toolbar del Ribbon:</span><br>  <span><a href="https://lh3.googleusercontent.com/-hF9OfYXlS5s/TypwfE38gcI/AAAAAAAAAkY/sU9CqSG5vqY/image_2.png" rel="lightbox"><img style="border-bottom: 0px; border-left: 0px; display: inline; border-top: 0px; border-right: 0px" title="image" border="0" alt="image" src="https://lh6.googleusercontent.com/-OQ4_Xj_efxs/TypweHbTerI/AAAAAAAAAkQ/uudTiCD52eY/image_thumb.png" width="244" height="167"></a>  <br><font size="1">Un po’ di pubblicità <em>occulta</em> a colui che mi fornisce i controlli: </font><a href="http://divelements.com/net/" target="_blank"><font size="1">Divelements</font></a><font size="1">.</font></span><br>  <span>il problema è che se il “report” che nasce da quella richiesta è di più di una pagina avete l’inghippo che la numerazione delle pagine viene sballata perchè il secondo item che stampate avrà la prima pagina numerata con un valore pari all’ultima dell’item precedente + 1… scomodo… decisamente.</span><br>  <span>Una soluzione che tampona il problema la potete realizzare, stampando direttamente senza passare per il viewer, mandando alla stampante più di un report, ma se l’utente vuole l’anteprima non è che gli possiamo far vedere <em>n</em> report viewer tanti quanti sono gli item selezionati sarebbe poco usabile.</span><br>  <span>I Report di Visual Studio, e anche i Reporting Services, non supportano nativamente questa funzionalità ma non è un problema farsela:</span><br>  <span>Dopo aver creato un nuovo report andate sulle proprietà e visualizzate la scheda Code:</span><br>  <span><a href="https://lh4.googleusercontent.com/-yI-F7sbrnN8/Typwgijr4XI/AAAAAAAAAko/PzfKSVhOQUk/image_4.png" rel="lightbox"><img style="border-bottom: 0px; border-left: 0px; display: inline; border-top: 0px; border-right: 0px" title="image" border="0" alt="image" src="https://lh3.googleusercontent.com/-sV6tZdA2bn8/TypwfySBz7I/AAAAAAAAAkc/a95oCw7x2Dc/image_thumb_1.png" width="213" height="115"></a> </span><br>  <span>nell’area Custom code incollate il seguente snippet:</span><br>  <blockquote>   <span>Shared offset as Integer     <br>Shared currentgroup as Object </span><br>    <span>Public Function GetGroupPageNumber(group as Object, pagenumber as Integer) as Object     <br>  If Not (group = currentgroup)      <br>   offset = pagenumber - 1      <br>   currentgroup = group      <br>  End If      <br>  Return pagenumber - offset      <br>End Function</span><br> </blockquote>  <span>A questo punto potete inserire nel vostro report un controllo List, assicuratevi che il controllo list contenga una TextBox (va benissimo anche Hidden) che visualizza il valore della group-key della lista stessa:</span><br>  <span><a href="https://lh5.googleusercontent.com/-J6G85vkUu6w/Typwh3STKVI/AAAAAAAAAk0/52rHPE_v9eA/image_6.png" rel="lightbox"><img style="border-bottom: 0px; border-left: 0px; display: inline; border-top: 0px; border-right: 0px" title="image" border="0" alt="image" src="https://lh4.googleusercontent.com/-5epD8_SY1RA/TypwhZh0QQI/AAAAAAAAAks/WYINUmrxOYw/image_thumb_2.png" width="190" height="177"></a> </span><br>  <span>e nel report ad esempio:</span><br>  <span><a href="https://lh5.googleusercontent.com/-oGgjW_KRQFA/Typwi4WzzSI/AAAAAAAAAlE/8Q3HTkQrwLM/image_8.png" rel="lightbox"><img style="border-bottom: 0px; border-left: 0px; display: inline; border-top: 0px; border-right: 0px" title="image" border="0" alt="image" src="https://lh3.googleusercontent.com/-2iQeYwkSMUc/TypwiVpvOJI/AAAAAAAAAlA/egtmrPgSDkw/image_thumb_3.png" width="182" height="60"></a> </span><br>  <span>Date un nome “sensato” a quella TextBox, ad esempio: <em>mainGroupingKey</em>. Fatto questo potete visualizzare il numero di pagina corrente in questo modo:</span><br>  <span><a href="https://lh6.googleusercontent.com/-RvYzOYnYDeE/TypwkkoR7KI/AAAAAAAAAlU/wL7LD5mLwnY/image_10.png" rel="lightbox"><img style="border-bottom: 0px; border-left: 0px; display: inline; border-top: 0px; border-right: 0px" title="image" border="0" alt="image" src="https://lh4.googleusercontent.com/-ufNh2s7F6sQ/Typwj6p2O5I/AAAAAAAAAlQ/rceSsnuiK-c/image_thumb_4.png" width="644" height="75"></a> </span><br>  <span>lo snippet di cui sopra farà in modo che il numero si resetti al cambio di “gruppo” ripartendo da 1.</span><br>  <blockquote>   <span><em>ndr 1</em>:      <br>La cosa funziona anche con i reporting services con il rischio però di collisioni perchè le variabili “shared” verrebbero condivise anche tra più istanze dello stesso report che venissero malauguratamente richieste in maniera concorrente, probabilmente un evento abbastanza remoto… ma sempre da considerare.</span><br> </blockquote>  <blockquote>   <span><em>ndr 2</em>:      <br>L’idea non è mia, googlando ho trovato un po’ di spunti ma non riesco più a risalire alla fonte quindi non posso linkarla, io mi sono limitato solo a fare qualche aggiustamento per adeguare il tutto al mio scenario.</span><br> </blockquote>  <span>.m</span><br>
