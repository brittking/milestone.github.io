---
layout: post
title: 'UI Composition :: Thread.Start()'
date: '2009-03-27T15:56:00.000+01:00'
author: Mauro Servienti
tags:
- Software Mason
- Architecture
- UI Composition
modified_time: '2012-01-31T14:03:11.285+01:00'
thumbnail: https://lh3.googleusercontent.com/-Fas0Nu8Ch-g/TyfmgkjpGJI/AAAAAAAAAUo/VQwkX1RYG4w/s72-c/image_thumb.png
blogger_id: tag:blogger.com,1999:blog-6511237790974218081.post-4266224558748969328
blogger_orig_url: http://milestone.topics.it/2009/03/ui-composition-threadstart.html
permalink: /2009/03/ui-composition-threadstart.html
---

<span>Immaginiamo uno scenario in cui sia necessario soddisfare i seguenti requisiti:</span><br>  <ol>   <li>Deve essere possibile scomporre l’applicazione in moduli funzionali:      <ol>       <li>I moduli funzionali devono essere independenti l’uno dall’altro; </li>        <li>I mdouli funzionali possono avere delle dipendenze logiche tra loro ma l’assenza di una dipendenza non deve precludere il funzionamento dell’applicazione o del modulo stesso; </li>        <li>I moduli funzionali devono poter essere rimpiazzati/aggiunti a caldo; </li>     </ol>   </li>    <li>L’applicazione deve poter essere installata in varie configurazioni, quindi non necessariamente con tutti i moduli funzionali; </li>    <li>L’utente non si deve rendere conto che l’applicazione è una composizione di moduli funzionali:      <ol>       <li>I moduli funzionali devono poter iniettare <u>logica</u> nell’applicazione e/o in altri moduli; </li>        <li>I moduli funzionali devono poter iniettare <u>parti</u> dell’interfaccia utente nell’applicazione e/o di altri moduli; </li>     </ol>   </li> </ol>  <span>e in contomperanea possa essere interessante assecondare i seguenti requisiti:</span><br>  <ol>   <li>Lo sviluppo dei moduli funzionali deve poter procedere in parallelo e in maniera indipendente; </li>    <li>I moduli funzionali devono poter essere sviluppati da team diversi; </li> </ol>  <span>Il “problema” ho iniziato ad affrontarlo qualche tempo fa e per prima cosa mi sono guardato in giro alla ricerca di soluzioni già pronte, ne ho trovate 2:</span><br>  <ol>   <li><a href="http://compositewpf.codeplex.com/" target="_blank">PRISM</a>: Prism è un’ottima soluzione direttamente dal team di Pattern & Practices di Microsoft, la v1 ha alcune lacune che verranno probabilmente risolte dalla v2 che è attualmente in beta; </li>    <li><a href="http://www.codeplex.com/caliburn" target="_blank">Caliburn</a>: è un toolkit open source che sembra realizzato proprio su misura per le mie necessità; </li> </ol>  <span>Entrambi <em>soffrono</em> di un problema: la curva di apprendimento è decisamente ripida. La cosa difficile da digerire all’inizio non è tanto dell’uso del toolkit ma sono piuttosto i concetti architetturali che stanno alla base della UI Composition e che non possono essere imposti e presi per buoni semplicemente leggendo la documentazione a corredo; è, imho, fondamentale capire a fondo quali sono le problematiche e come risolverle per poter:</span><br>  <ul>   <li>decidere se il toolkit risolverà tutte le nostre necessità; </li>    <li>quale toolkit scegliere conoscendone pregi e difetti, perchè una volta fatta la scelta ci si lega mani e piedi a quel toolkit; </li> </ul>  <span>Per studiare e capire ho deciso di realizzare un <em>proof-of-concept</em> che soddisfacesse i requisiti a cui abbiamo accennato e che mi permettesse anche di “evadere” alcune delle User Story che ho sulla lavagna, come ad esempio (sintetizzo):</span><br>  <ul>   <li>L’utente deve poter cercare all’interno dell’anagrafica dei soggetti; </li>    <li>L’utente deve poter visualizzare in contemporanea i risultati di diverse query nell’anagrafica dei soggetti; </li>    <li>L’utente, a seguito di una ricerca, deve poter visualizzare il dettaglio di uno dei soggetti; </li>    <li>Il dettaglio di un soggetto deve contenere una <u>sintesi</u> della situazione del soggetto selezionato (<em>ndr</em>: ad esempio contratti in essere, preventivi, situazione contabile, etc..); </li>    <li>L’utente deve poter “aprire” un soggetto e visualizzarne i dettagli <u>completi</u> (<em>ndr</em>: quindi non una sintesi); </li>    <li>L’utente deve poter “aprire” più di un soggetto in contemporanea; </li> </ul>  <span>Perchè elencare alcune User Story? perchè mettersi il cappellino del nostro utente finale è probabilmente l’unico modo per immergersi realmente in quelli che sono i desideri del nostro cliente ed è l’unico modo per capire cosa dobbiamo realmente realizzare. Leggendo le sotrie direi che non notiamo nulla di trascendentale, anzi non c’è nulla che un normalissimo “gestionale” da supermercato non faccia, ma… se mixiamo le storie con i requisiti di cui sopra le cose si complicano un filino:</span><br>  <blockquote>   <span>…Il dettaglio di un soggetto deve contenere una sintesi della situazione del soggetto selezionato…</span><br> </blockquote>  <span>Se ci pensiamo qui siamo di fronte ad un problema; immaginamo, per semplicità, una UI simile a quella di Outlook:</span><br>  <span><a href="https://lh4.googleusercontent.com/-TKJSeFDHqlc/TyfmhC7g5UI/AAAAAAAAAUw/H7qO85E0GU0/image_2.png" rel="lightbox"><img style="border-right-width: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px" title="image" border="0" alt="image" src="https://lh3.googleusercontent.com/-Fas0Nu8Ch-g/TyfmgkjpGJI/AAAAAAAAAUo/VQwkX1RYG4w/image_thumb.png" width="244" height="153"></a> </span><br>  <span>Abbiamo una list view che contiene il risultato di una ricerca, alla selezione di un elemento viene visualizzato un dettaglio dell’elemento selezionato… ma noi abbiamo la necessità che quel dettaglio contenga informazioni che arrivano da moduli diversi, informazioni che devono essere “meshed-up” in maniera totalmente trasparente all’utente. Potremmo andare avanti con questo giochetto all’infinito, il p-o-c che ho realizzato credo che affronti e risolva tutte le possibilità, reportistica compresa, e sicuramente affronta e risolve tutte le mie necessità.</span><br>  <span>Cominciamo quindi con il mettere un po’ di puntini sulle “i”, gli attori in questo gioco sono:</span><br>  <ul>   <li>Un contenitore, che è poi l’applicazione, che ospita la UI: <em>introducing the <u>Shell</u></em>; </li>    <li>Un <u><em>bootstrapper</em></u> che è responsabile dello startup dell’applicazione e generalmente orchestra il caricamento dei moduli; </li>    <li>Uno o più <em><u>moduli</u></em> che rappresentano le aree funzionali che dovranno soddisfare i bisogni dell’utente:       <ul>       <li>Un modulo anagrafiche; </li>        <li>Un modulo fatturazione; </li>        <li>Un modulo inserzioni/pubblicità; </li>        <li>Un mdoulo pubblicazione; </li>     </ul>   </li> </ul>  <span>…si capisce che sto lavorando per un giornale?</span><br>  <span>Le scelte tecnologiche sono ricadute su:</span><br>  <ul>   <li>WPF: i vantaggi sono spaventosi, se solo penso a quello che le attached properties mi hanno permesso di fare…; </li>    <li>M-V-VM: come pattern architetturale per la gestione dell’interazione tra UI e Modello, spettacolo ;-); </li>    <li>Castle Windsor, il primo amore non si scorda mai, per la gestione dell’infrastruttura; </li> </ul>  <span>Il nostro primo obiettivo è arrivare a risolvere questo problema:</span><br>  <span><a href="https://lh4.googleusercontent.com/-lFu3R4kcQaE/TyfmiaEndnI/AAAAAAAAAU8/ShNFyGQpAQo/image_4.png" rel="lightbox"><img style="border-right-width: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px" title="image" border="0" alt="image" src="https://lh3.googleusercontent.com/-SQiu6beKzPs/Tyfmh9iodbI/AAAAAAAAAU0/XjZzeaMwDBA/image_thumb_1.png" width="244" height="184"></a> </span><br>  <span>Abbiamo delle aree all’interno dell’applicazione che devono poter ospitare altre aree, che a loro volta potrebbero ospitarne altre e via dicendo…, la cosa interessante è che queste aree possono essere:</span><br>  <ul>   <li><em>Statiche</em>: aka note a priori, nell’immagine ad esempio l’area che opsita le “Toolbars” o l’area che ospita i “Documents”; </li>    <li><em>Dinamiche</em>: aree che nascono a runtime e che sono legate a quello che sta succedendo: si è contorto ma capiremo cosa vuol dire; </li> </ul>  <span>Nel linguaggio della UI Composition queste aree si chiamano <u><em>Region</em></u>: una region definisce una porzione logica della UI in cui potranno essere iniettati contenuti, sarà onere/onore della region decidere come gestire e visualizzare i contenuti stessi.</span><br>  <span>Dopo un bel po’ di lavoro, fatto anche di moltissime elucubrazioni notturne, sono giunto a questo:</span><br>  <span><a href="https://lh3.googleusercontent.com/-kRsNoeKl2zU/TyfmjrZBBKI/AAAAAAAAAVM/4VjuJ-Pqimo/image_6.png" rel="lightbox"><img style="border-right-width: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px" title="image" border="0" alt="image" src="https://lh5.googleusercontent.com/-b7kR6M2qXfQ/Tyfmi2Mq0yI/AAAAAAAAAVI/9ehg7nLMlCM/image_thumb_2.png" width="244" height="173"></a> </span><br>  <span>Come?</span><br>  <span>bhe… adesso volete troppo, maeriale per le prossime puntate direi che ce ne è decisamente parecchio.</span><br>  <span>In questa sede mi limito a dare un paio di dettagli “contabili”: </span><br>  <ul>   <li>studio:      <ul>       <li>dei requisiti; </li>        <li>dei toolkit esistenti; </li>     </ul>   </li>    <li>realizzazione dell’architettura; </li>    <li>realizzazione e test del concept che soddisfasse <u>tutti</u> i requisiti di cui sopra; </li>    <li>refactoring per estrarre un toolkit; </li> </ul>  <span>Totale 8 giornate, per tutto il resto c’è mastercard :-D</span><br>  <span>Questa esperienza mi permette di asserire che:</span><br>  <ul>   <li>Ho capito fino al “midollo” come funziona il gioco e quali sono le regole; </li>    <li>Ho capito quali sono i limiti di PRISM e perchè la v1 non va bene nel mio scenario e questo mi fa dire che queste 8 giornate sono state spese decisamente bene perchè scoprire un <em>dettaglio</em> come questo in itinere sarebbe stato un bagno di sangue; </li>    <li>Ho un toolkit funzionante e utilizzabile da cui consegue che non ho bisogno di affrontare l’eventuale “problema” Caliburn; </li>    <li>Fine settimana prossima probabilmente riesco a chiudere l’iterazione…e sono felice perchè sto imparando: ship it; </li>    <li>un dettaglio… ho vinto la scommessa con il mio <em>collega</em> ottantaseienne: Paolo un uomo, un mito; </li> </ul>  <span>Se siete interessati ai “noiosissimi” dettagli tecnici che tengono in piedi il castello battete un colpo <em>& stay tuned ;-)</em></span><br>  <span>.m</span><br>  
