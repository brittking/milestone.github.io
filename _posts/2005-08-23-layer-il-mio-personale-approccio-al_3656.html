---
layout: post
title: Layer, il mio personale approccio al problema (Parte I)
date: '2005-08-23T13:31:00.002+02:00'
author: Mauro Servienti
tags:
- Why not...
modified_time: '2012-01-25T21:24:52.945+01:00'
blogger_id: tag:blogger.com,1999:blog-6511237790974218081.post-6633514825471552587
blogger_orig_url: http://milestone.topics.it/2005/08/layer-il-mio-personale-approccio-al_3656.html
---

<span>Approfitto di questi schermi per...</span><br>
<span>Ogni tanto (IMHO non abbastanza) sui NewsGroup si 
parla di design e l'argomento principe per chi si sta approcciando al problema è 
quasi sempre la stratificazione (suddivisione in Layer) delle 
applicazioni.<br>Naturalmente il "problema" l'ho dovuto 
sviscerare anche io e dopo varie reimplementazioni l'ho <em>"rilsolto"</em> (almeno per 
ora).</span><br>
<span>Quando sono di fronte ad applicazioni di un certo "spessore" la struttura è sintetizzabile 
così:</span><br>
<span><strong>Domain Layer<br></strong>Rappresenta lo strato di business e contiene 
tutte le classi/entities necessarie.<br>Una esempio tipo di business entity(s) 
potrebbe essere:</span><br>
<div style="BORDER-RIGHT: black 1px solid; PADDING-RIGHT: 5px; BORDER-TOP: black 1px solid; PADDING-LEFT: 5px; PADDING-BOTTOM: 5px; BORDER-LEFT: black 1px solid; PADDING-TOP: 5px; BORDER-BOTTOM: black 1px solid; BACKGROUND-COLOR: gainsboro"><span style="FONT-SIZE: 10pt; COLOR: #008000; FONT-FAMILY: Courier New">//<br>// ASSEMBLY<br>// Topics.Common.dll<br>//<br><br>/*<br>    MyObject è la classe di base da cui tutte le <br>    entity del mio framework erditano<br>*/<br></span><span style="FONT-SIZE: 10pt; COLOR: #0000ff; FONT-FAMILY: Courier New">public abstract class </span><span style="FONT-SIZE: 10pt; COLOR: #000000; FONT-FAMILY: Courier New">MyObject<br>{<br>    </span><span style="FONT-SIZE: 10pt; COLOR: #0000ff; FONT-FAMILY: Courier New">protected virtual void </span><span style="FONT-SIZE: 10pt; COLOR: #000000; FONT-FAMILY: Courier New">Initialize( System.Data.IDataReader reader )<br>    {<br>        </span><span style="FONT-SIZE: 10pt; COLOR: #0000ff; FONT-FAMILY: Courier New">if</span><span style="FONT-SIZE: 10pt; COLOR: #000000; FONT-FAMILY: Courier New">( reader == </span><span style="FONT-SIZE: 10pt; COLOR: #0000ff; FONT-FAMILY: Courier New">null </span><span style="FONT-SIZE: 10pt; COLOR: #000000; FONT-FAMILY: Courier New">)<br>        {<br>            </span><span style="FONT-SIZE: 10pt; COLOR: #008000; FONT-FAMILY: Courier New">/*<br>            L'istanza rappresenta un nuovo oggetto<br>            quindi inizializziamo i field con i<br>            valori di default<br>            */<br>            </span><span style="FONT-SIZE: 10pt; COLOR: #0000ff; FONT-FAMILY: Courier New">this</span><span style="FONT-SIZE: 10pt; COLOR: #000000; FONT-FAMILY: Courier New">._uid = Guid.NewGuid();<br>            </span><span style="FONT-SIZE: 10pt; COLOR: #0000ff; FONT-FAMILY: Courier New">this</span><span style="FONT-SIZE: 10pt; COLOR: #000000; FONT-FAMILY: Courier New">._description = String.Empty;<br>            <br>            </span><span style="FONT-SIZE: 10pt; COLOR: #0000ff; FONT-FAMILY: Courier New">this</span><span style="FONT-SIZE: 10pt; COLOR: #000000; FONT-FAMILY: Courier New">._isNew = </span><span style="FONT-SIZE: 10pt; COLOR: #0000ff; FONT-FAMILY: Courier New">true</span><span style="FONT-SIZE: 10pt; COLOR: #000000; FONT-FAMILY: Courier New">;<br>        }<br>        </span><span style="FONT-SIZE: 10pt; COLOR: #0000ff; FONT-FAMILY: Courier New">else<br>        </span><span style="FONT-SIZE: 10pt; COLOR: #000000; FONT-FAMILY: Courier New">{<br>            </span><span style="FONT-SIZE: 10pt; COLOR: #0000ff; FONT-FAMILY: Courier New">this</span><span style="FONT-SIZE: 10pt; COLOR: #000000; FONT-FAMILY: Courier New">._uid = reader.GetGuid( reader.GetOrdinal( "UID" ) );<br>            </span><span style="FONT-SIZE: 10pt; COLOR: #0000ff; FONT-FAMILY: Courier New">this</span><span style="FONT-SIZE: 10pt; COLOR: #000000; FONT-FAMILY: Courier New">._description = reader.GetString( reader.GetOrdinal( "Description" ) );<br>            <br>            </span><span style="FONT-SIZE: 10pt; COLOR: #0000ff; FONT-FAMILY: Courier New">this</span><span style="FONT-SIZE: 10pt; COLOR: #000000; FONT-FAMILY: Courier New">._isNew = </span><span style="FONT-SIZE: 10pt; COLOR: #0000ff; FONT-FAMILY: Courier New">false</span><span style="FONT-SIZE: 10pt; COLOR: #000000; FONT-FAMILY: Courier New">;<br>        }<br>    }<br>    <br>    </span><span style="FONT-SIZE: 10pt; COLOR: #0000ff; FONT-FAMILY: Courier New">protected </span><span style="FONT-SIZE: 10pt; COLOR: #000000; FONT-FAMILY: Courier New">MyObject( System.Data.IDataReader reader )<br>    {<br>        </span><span style="FONT-SIZE: 10pt; COLOR: #0000ff; FONT-FAMILY: Courier New">if</span><span style="FONT-SIZE: 10pt; COLOR: #000000; FONT-FAMILY: Courier New">( reader == </span><span style="FONT-SIZE: 10pt; COLOR: #0000ff; FONT-FAMILY: Courier New">null </span><span style="FONT-SIZE: 10pt; COLOR: #000000; FONT-FAMILY: Courier New">)<br>        {<br>            </span><span style="FONT-SIZE: 10pt; COLOR: #0000ff; FONT-FAMILY: Courier New">throw new </span><span style="FONT-SIZE: 10pt; COLOR: #000000; FONT-FAMILY: Courier New">ArgumentException( "Invalid Source" );<br>        }<br>        <br>        </span><span style="FONT-SIZE: 10pt; COLOR: #0000ff; FONT-FAMILY: Courier New">this</span><span style="FONT-SIZE: 10pt; COLOR: #000000; FONT-FAMILY: Courier New">.Initialize( reader );<br>    }<br>    <br>    </span><span style="FONT-SIZE: 10pt; COLOR: #0000ff; FONT-FAMILY: Courier New">protected </span><span style="FONT-SIZE: 10pt; COLOR: #000000; FONT-FAMILY: Courier New">MyObject()<br>    {<br>        </span><span style="FONT-SIZE: 10pt; COLOR: #0000ff; FONT-FAMILY: Courier New">this</span><span style="FONT-SIZE: 10pt; COLOR: #000000; FONT-FAMILY: Courier New">.Initialize( </span><span style="FONT-SIZE: 10pt; COLOR: #0000ff; FONT-FAMILY: Courier New">null </span><span style="FONT-SIZE: 10pt; COLOR: #000000; FONT-FAMILY: Courier New">);<br>    }<br>    <br>    </span><span style="FONT-SIZE: 10pt; COLOR: #0000ff; FONT-FAMILY: Courier New">private </span><span style="FONT-SIZE: 10pt; COLOR: #000000; FONT-FAMILY: Courier New">Guid _uid;<br>    <br>    </span><span style="FONT-SIZE: 10pt; COLOR: #008000; FONT-FAMILY: Courier New">//La chiave primaria<br>    </span><span style="FONT-SIZE: 10pt; COLOR: #0000ff; FONT-FAMILY: Courier New">public </span><span style="FONT-SIZE: 10pt; COLOR: #000000; FONT-FAMILY: Courier New">Guid UID<br>    {<br>        </span><span style="FONT-SIZE: 10pt; COLOR: #0000ff; FONT-FAMILY: Courier New">get</span><span style="FONT-SIZE: 10pt; COLOR: #000000; FONT-FAMILY: Courier New">{ </span><span style="FONT-SIZE: 10pt; COLOR: #0000ff; FONT-FAMILY: Courier New">return this</span><span style="FONT-SIZE: 10pt; COLOR: #000000; FONT-FAMILY: Courier New">._uid; }<br>    }<br>    <br>    </span><span style="FONT-SIZE: 10pt; COLOR: #0000ff; FONT-FAMILY: Courier New">private bool </span><span style="FONT-SIZE: 10pt; COLOR: #000000; FONT-FAMILY: Courier New">_isNew;<br>    </span><span style="FONT-SIZE: 10pt; COLOR: #008000; FONT-FAMILY: Courier New">/*<br>        La proprietà in sola lettura IsNew<br>        ci permette di sapere se l'istanza<br>        che stiamo maneggiando arriva da un <br>        DataSource o sia una nuovo elemento<br>    */<br>    </span><span style="FONT-SIZE: 10pt; COLOR: #0000ff; FONT-FAMILY: Courier New">public bool </span><span style="FONT-SIZE: 10pt; COLOR: #000000; FONT-FAMILY: Courier New">IsNew<br>    {<br>        </span><span style="FONT-SIZE: 10pt; COLOR: #0000ff; FONT-FAMILY: Courier New">get</span><span style="FONT-SIZE: 10pt; COLOR: #000000; FONT-FAMILY: Courier New">{ </span><span style="FONT-SIZE: 10pt; COLOR: #0000ff; FONT-FAMILY: Courier New">return this</span><span style="FONT-SIZE: 10pt; COLOR: #000000; FONT-FAMILY: Courier New">._isNew; }<br>    }<br>    <br>    </span><span style="FONT-SIZE: 10pt; COLOR: #0000ff; FONT-FAMILY: Courier New">private string </span><span style="FONT-SIZE: 10pt; COLOR: #000000; FONT-FAMILY: Courier New">_description;<br>    </span><span style="FONT-SIZE: 10pt; COLOR: #0000ff; FONT-FAMILY: Courier New">public string </span><span style="FONT-SIZE: 10pt; COLOR: #000000; FONT-FAMILY: Courier New">Description<br>    {<br>        </span><span style="FONT-SIZE: 10pt; COLOR: #0000ff; FONT-FAMILY: Courier New">get</span><span style="FONT-SIZE: 10pt; COLOR: #000000; FONT-FAMILY: Courier New">{ </span><span style="FONT-SIZE: 10pt; COLOR: #0000ff; FONT-FAMILY: Courier New">return this</span><span style="FONT-SIZE: 10pt; COLOR: #000000; FONT-FAMILY: Courier New">._description; }<br>        </span><span style="FONT-SIZE: 10pt; COLOR: #0000ff; FONT-FAMILY: Courier New">set<br>        </span><span style="FONT-SIZE: 10pt; COLOR: #000000; FONT-FAMILY: Courier New">{<br>            </span><span style="FONT-SIZE: 10pt; COLOR: #0000ff; FONT-FAMILY: Courier New">if</span><span style="FONT-SIZE: 10pt; COLOR: #000000; FONT-FAMILY: Courier New">( </span><span style="FONT-SIZE: 10pt; COLOR: #0000ff; FONT-FAMILY: Courier New">value </span><span style="FONT-SIZE: 10pt; COLOR: #000000; FONT-FAMILY: Courier New">== </span><span style="FONT-SIZE: 10pt; COLOR: #0000ff; FONT-FAMILY: Courier New">null </span><span style="FONT-SIZE: 10pt; COLOR: #000000; FONT-FAMILY: Courier New">)<br>            {<br>                </span><span style="FONT-SIZE: 10pt; COLOR: #0000ff; FONT-FAMILY: Courier New">value </span><span style="FONT-SIZE: 10pt; COLOR: #000000; FONT-FAMILY: Courier New">= String.Empty;<br>            }<br>            <br>            </span><span style="FONT-SIZE: 10pt; COLOR: #0000ff; FONT-FAMILY: Courier New">if</span><span style="FONT-SIZE: 10pt; COLOR: #000000; FONT-FAMILY: Courier New">( !</span><span style="FONT-SIZE: 10pt; COLOR: #0000ff; FONT-FAMILY: Courier New">value</span><span style="FONT-SIZE: 10pt; COLOR: #000000; FONT-FAMILY: Courier New">.Equals( </span><span style="FONT-SIZE: 10pt; COLOR: #0000ff; FONT-FAMILY: Courier New">this</span><span style="FONT-SIZE: 10pt; COLOR: #000000; FONT-FAMILY: Courier New">._description ) )<br>            {<br>                </span><span style="FONT-SIZE: 10pt; COLOR: #0000ff; FONT-FAMILY: Courier New">this</span><span style="FONT-SIZE: 10pt; COLOR: #000000; FONT-FAMILY: Courier New">._description = </span><span style="FONT-SIZE: 10pt; COLOR: #0000ff; FONT-FAMILY: Courier New">value</span><span style="FONT-SIZE: 10pt; COLOR: #000000; FONT-FAMILY: Courier New">; <br>            }<br>        }<br>    }<br>    <br>    </span><span style="FONT-SIZE: 10pt; COLOR: #008000; FONT-FAMILY: Courier New">/*<br>        ParametersCollection (omessa per semplicità) non è che una<br>        collection di coppia Key (String)/Value (Object) che viene <br>        usata a mo di MOC object al fine di scambiare dati con lo <br>        strato di factory<br>    */<br>    </span><span style="FONT-SIZE: 10pt; COLOR: #0000ff; FONT-FAMILY: Courier New">protected virtual </span><span style="FONT-SIZE: 10pt; COLOR: #000000; FONT-FAMILY: Courier New">ParametersCollection GetParameters()<br>    {<br>        ParametersCollection parameters = </span><span style="FONT-SIZE: 10pt; COLOR: #0000ff; FONT-FAMILY: Courier New">new </span><span style="FONT-SIZE: 10pt; COLOR: #000000; FONT-FAMILY: Courier New">ParametersCollection();<br>        parameters.Add( "UID", </span><span style="FONT-SIZE: 10pt; COLOR: #0000ff; FONT-FAMILY: Courier New">this</span><span style="FONT-SIZE: 10pt; COLOR: #000000; FONT-FAMILY: Courier New">.UID );<br>        parameters.Add( "Description", </span><span style="FONT-SIZE: 10pt; COLOR: #0000ff; FONT-FAMILY: Courier New">this</span><span style="FONT-SIZE: 10pt; COLOR: #000000; FONT-FAMILY: Courier New">.Description );<br>        <br>        </span><span style="FONT-SIZE: 10pt; COLOR: #0000ff; FONT-FAMILY: Courier New">return </span><span style="FONT-SIZE: 10pt; COLOR: #000000; FONT-FAMILY: Courier New">parameters;<br>    }<br>    <br>    </span><span style="FONT-SIZE: 10pt; COLOR: #0000ff; FONT-FAMILY: Courier New">protected abstract void </span><span style="FONT-SIZE: 10pt; COLOR: #000000; FONT-FAMILY: Courier New">InsertData( ParametersCollection parameters );<br>    </span><span style="FONT-SIZE: 10pt; COLOR: #0000ff; FONT-FAMILY: Courier New">protected abstract void </span><span style="FONT-SIZE: 10pt; COLOR: #000000; FONT-FAMILY: Courier New">UpdateData( ParametersCollection parameters );<br>    </span><span style="FONT-SIZE: 10pt; COLOR: #0000ff; FONT-FAMILY: Courier New">protected abstract void </span><span style="FONT-SIZE: 10pt; COLOR: #000000; FONT-FAMILY: Courier New">DeleteData( ParametersCollection parameters );<br>    <br>    </span><span style="FONT-SIZE: 10pt; COLOR: #0000ff; FONT-FAMILY: Courier New">public void </span><span style="FONT-SIZE: 10pt; COLOR: #000000; FONT-FAMILY: Courier New">Save()<br>    {<br>        </span><span style="FONT-SIZE: 10pt; COLOR: #008000; FONT-FAMILY: Courier New">/*<br>            Nell'applicazione reale la gestione è decisamente più<br>            complessa e comprende una serie di eventi che permettono <br>            di manipolare dall'esterno alcuni aspetti e consento anche<br>            di interrompere il processo di salvataggio e/o cancellazione<br>        */<br>        </span><span style="FONT-SIZE: 10pt; COLOR: #000000; FONT-FAMILY: Courier New">ParametersCollection parameters = </span><span style="FONT-SIZE: 10pt; COLOR: #0000ff; FONT-FAMILY: Courier New">this</span><span style="FONT-SIZE: 10pt; COLOR: #000000; FONT-FAMILY: Courier New">.GetParameters();<br><br>        </span><span style="FONT-SIZE: 10pt; COLOR: #008000; FONT-FAMILY: Courier New">/*<br>            Usiamo IsNew per determinare quale sia l'azione<br>            da intraprendere per il salvataggio<br>        */<br>        </span><span style="FONT-SIZE: 10pt; COLOR: #0000ff; FONT-FAMILY: Courier New">if</span><span style="FONT-SIZE: 10pt; COLOR: #000000; FONT-FAMILY: Courier New">( </span><span style="FONT-SIZE: 10pt; COLOR: #0000ff; FONT-FAMILY: Courier New">this</span><span style="FONT-SIZE: 10pt; COLOR: #000000; FONT-FAMILY: Courier New">.IsNew )<br>        {<br>            </span><span style="FONT-SIZE: 10pt; COLOR: #0000ff; FONT-FAMILY: Courier New">this</span><span style="FONT-SIZE: 10pt; COLOR: #000000; FONT-FAMILY: Courier New">.InsertData( parameters );<br>        }<br>        </span><span style="FONT-SIZE: 10pt; COLOR: #0000ff; FONT-FAMILY: Courier New">else<br>        </span><span style="FONT-SIZE: 10pt; COLOR: #000000; FONT-FAMILY: Courier New">{<br>            </span><span style="FONT-SIZE: 10pt; COLOR: #0000ff; FONT-FAMILY: Courier New">this</span><span style="FONT-SIZE: 10pt; COLOR: #000000; FONT-FAMILY: Courier New">.UpdateData( parameters );<br>        }<br>    }<br>    <br>    </span><span style="FONT-SIZE: 10pt; COLOR: #0000ff; FONT-FAMILY: Courier New">public void </span><span style="FONT-SIZE: 10pt; COLOR: #000000; FONT-FAMILY: Courier New">Delete()<br>    {<br>        ParametersCollection parameters = </span><span style="FONT-SIZE: 10pt; COLOR: #0000ff; FONT-FAMILY: Courier New">new </span><span style="FONT-SIZE: 10pt; COLOR: #000000; FONT-FAMILY: Courier New">ParametersCollection();<br>        parameters.Add( "UID", </span><span style="FONT-SIZE: 10pt; COLOR: #0000ff; FONT-FAMILY: Courier New">this</span><span style="FONT-SIZE: 10pt; COLOR: #000000; FONT-FAMILY: Courier New">.UID );<br>        <br>        </span><span style="FONT-SIZE: 10pt; COLOR: #0000ff; FONT-FAMILY: Courier New">this</span><span style="FONT-SIZE: 10pt; COLOR: #000000; FONT-FAMILY: Courier New">.DeleteData( parameters );<br>    }<br>}<br><br></span><span style="FONT-SIZE: 10pt; COLOR: #008000; FONT-FAMILY: Courier New">//<br>// ASSEMBLY<br>// Topics.MyApplication.Domain.dll<br>//<br><br></span><span style="FONT-SIZE: 10pt; COLOR: #0000ff; FONT-FAMILY: Courier New">public class </span><span style="FONT-SIZE: 10pt; COLOR: #000000; FONT-FAMILY: Courier New">MyCustomer : MyObject<br>{<br>    </span><span style="FONT-SIZE: 10pt; COLOR: #0000ff; FONT-FAMILY: Courier New">protected override void </span><span style="FONT-SIZE: 10pt; COLOR: #000000; FONT-FAMILY: Courier New">Initialize( System.Data.IDataReader reader )<br>    {<br>        </span><span style="FONT-SIZE: 10pt; COLOR: #0000ff; FONT-FAMILY: Courier New">if</span><span style="FONT-SIZE: 10pt; COLOR: #000000; FONT-FAMILY: Courier New">( reader == </span><span style="FONT-SIZE: 10pt; COLOR: #0000ff; FONT-FAMILY: Courier New">null </span><span style="FONT-SIZE: 10pt; COLOR: #000000; FONT-FAMILY: Courier New">)<br>        {<br>            </span><span style="FONT-SIZE: 10pt; COLOR: #008000; FONT-FAMILY: Courier New">/*<br>            L'istanza rappresenta un nuovo oggetto<br>            quindi inizializziamo i field con i<br>            valori di default<br>            */<br>            </span><span style="FONT-SIZE: 10pt; COLOR: #0000ff; FONT-FAMILY: Courier New">this</span><span style="FONT-SIZE: 10pt; COLOR: #000000; FONT-FAMILY: Courier New">._companyName = String.Empty;<br>        }<br>        </span><span style="FONT-SIZE: 10pt; COLOR: #0000ff; FONT-FAMILY: Courier New">else<br>        </span><span style="FONT-SIZE: 10pt; COLOR: #000000; FONT-FAMILY: Courier New">{<br>            </span><span style="FONT-SIZE: 10pt; COLOR: #0000ff; FONT-FAMILY: Courier New">this</span><span style="FONT-SIZE: 10pt; COLOR: #000000; FONT-FAMILY: Courier New">._companyName = reader.GetString( reader.GetOrdinal( "CompanyName" ) );<br>        }<br>    }<br><br>    </span><span style="FONT-SIZE: 10pt; COLOR: #0000ff; FONT-FAMILY: Courier New">public </span><span style="FONT-SIZE: 10pt; COLOR: #000000; FONT-FAMILY: Courier New">MyCustomer( System.Data.IDataReader reader )<br>        : </span><span style="FONT-SIZE: 10pt; COLOR: #0000ff; FONT-FAMILY: Courier New">base</span><span style="FONT-SIZE: 10pt; COLOR: #000000; FONT-FAMILY: Courier New">( reader )<br>    {<br>        <br>    }<br>    <br>    </span><span style="FONT-SIZE: 10pt; COLOR: #0000ff; FONT-FAMILY: Courier New">public </span><span style="FONT-SIZE: 10pt; COLOR: #000000; FONT-FAMILY: Courier New">MyCustomer()<br>        : </span><span style="FONT-SIZE: 10pt; COLOR: #0000ff; FONT-FAMILY: Courier New">base</span><span style="FONT-SIZE: 10pt; COLOR: #000000; FONT-FAMILY: Courier New">()<br>    {<br>        <br>    }<br>    <br>    </span><span style="FONT-SIZE: 10pt; COLOR: #0000ff; FONT-FAMILY: Courier New">private string </span><span style="FONT-SIZE: 10pt; COLOR: #000000; FONT-FAMILY: Courier New">_companyName;<br>    </span><span style="FONT-SIZE: 10pt; COLOR: #0000ff; FONT-FAMILY: Courier New">public string </span><span style="FONT-SIZE: 10pt; COLOR: #000000; FONT-FAMILY: Courier New">CompanyName<br>    {<br>        </span><span style="FONT-SIZE: 10pt; COLOR: #0000ff; FONT-FAMILY: Courier New">get</span><span style="FONT-SIZE: 10pt; COLOR: #000000; FONT-FAMILY: Courier New">{ </span><span style="FONT-SIZE: 10pt; COLOR: #0000ff; FONT-FAMILY: Courier New">return this</span><span style="FONT-SIZE: 10pt; COLOR: #000000; FONT-FAMILY: Courier New">._companyName; }<br>        </span><span style="FONT-SIZE: 10pt; COLOR: #0000ff; FONT-FAMILY: Courier New">set<br>        </span><span style="FONT-SIZE: 10pt; COLOR: #000000; FONT-FAMILY: Courier New">{<br>            </span><span style="FONT-SIZE: 10pt; COLOR: #0000ff; FONT-FAMILY: Courier New">if</span><span style="FONT-SIZE: 10pt; COLOR: #000000; FONT-FAMILY: Courier New">( </span><span style="FONT-SIZE: 10pt; COLOR: #0000ff; FONT-FAMILY: Courier New">value </span><span style="FONT-SIZE: 10pt; COLOR: #000000; FONT-FAMILY: Courier New">== </span><span style="FONT-SIZE: 10pt; COLOR: #0000ff; FONT-FAMILY: Courier New">null </span><span style="FONT-SIZE: 10pt; COLOR: #000000; FONT-FAMILY: Courier New">)<br>            {<br>                </span><span style="FONT-SIZE: 10pt; COLOR: #0000ff; FONT-FAMILY: Courier New">value </span><span style="FONT-SIZE: 10pt; COLOR: #000000; FONT-FAMILY: Courier New">= String.Empty;<br>            }<br>            <br>            </span><span style="FONT-SIZE: 10pt; COLOR: #0000ff; FONT-FAMILY: Courier New">if</span><span style="FONT-SIZE: 10pt; COLOR: #000000; FONT-FAMILY: Courier New">( !</span><span style="FONT-SIZE: 10pt; COLOR: #0000ff; FONT-FAMILY: Courier New">value</span><span style="FONT-SIZE: 10pt; COLOR: #000000; FONT-FAMILY: Courier New">.Equals( </span><span style="FONT-SIZE: 10pt; COLOR: #0000ff; FONT-FAMILY: Courier New">this</span><span style="FONT-SIZE: 10pt; COLOR: #000000; FONT-FAMILY: Courier New">._companyName ) )<br>            {<br>                </span><span style="FONT-SIZE: 10pt; COLOR: #0000ff; FONT-FAMILY: Courier New">this</span><span style="FONT-SIZE: 10pt; COLOR: #000000; FONT-FAMILY: Courier New">._companyName = </span><span style="FONT-SIZE: 10pt; COLOR: #0000ff; FONT-FAMILY: Courier New">value</span><span style="FONT-SIZE: 10pt; COLOR: #000000; FONT-FAMILY: Courier New">; <br>            }<br>        }<br>    }<br>    <br>    </span><span style="FONT-SIZE: 10pt; COLOR: #0000ff; FONT-FAMILY: Courier New">protected override </span><span style="FONT-SIZE: 10pt; COLOR: #000000; FONT-FAMILY: Courier New">ParametersCollection GetParameters()<br>    {<br>        ParametersCollection parameters = </span><span style="FONT-SIZE: 10pt; COLOR: #0000ff; FONT-FAMILY: Courier New">base</span><span style="FONT-SIZE: 10pt; COLOR: #000000; FONT-FAMILY: Courier New">.GetParameters();<br>        parameters.Add( "CompanyName", </span><span style="FONT-SIZE: 10pt; COLOR: #0000ff; FONT-FAMILY: Courier New">this</span><span style="FONT-SIZE: 10pt; COLOR: #000000; FONT-FAMILY: Courier New">.CompanyName );<br>        <br>        </span><span style="FONT-SIZE: 10pt; COLOR: #0000ff; FONT-FAMILY: Courier New">return </span><span style="FONT-SIZE: 10pt; COLOR: #000000; FONT-FAMILY: Courier New">parameters;<br>    }<br>    <br>    </span><span style="FONT-SIZE: 10pt; COLOR: #0000ff; FONT-FAMILY: Courier New">protected override void </span><span style="FONT-SIZE: 10pt; COLOR: #000000; FONT-FAMILY: Courier New">InsertData( ParametersCollection parameters )<br>    {<br>        </span><span style="FONT-SIZE: 10pt; COLOR: #008000; FONT-FAMILY: Courier New">/*<br>            TODO<br>            Solo la classe "reale" Customer conosce il sistema<br>            per persistere/manipolare i propri dati<br>        */<br>    </span><span style="FONT-SIZE: 10pt; COLOR: #000000; FONT-FAMILY: Courier New">}<br>    <br>    </span><span style="FONT-SIZE: 10pt; COLOR: #0000ff; FONT-FAMILY: Courier New">protected override void </span><span style="FONT-SIZE: 10pt; COLOR: #000000; FONT-FAMILY: Courier New">UpdateData( ParametersCollection parameters )<br>    {<br>        </span><span style="FONT-SIZE: 10pt; COLOR: #008000; FONT-FAMILY: Courier New">/*<br>            TODO<br>            Solo la classe "reale" Customer conosce il sistema<br>            per persistere/manipolare i propri dati<br>        */<br>    </span><span style="FONT-SIZE: 10pt; COLOR: #000000; FONT-FAMILY: Courier New">}<br>    <br>    </span><span style="FONT-SIZE: 10pt; COLOR: #0000ff; FONT-FAMILY: Courier New">protected override void </span><span style="FONT-SIZE: 10pt; COLOR: #000000; FONT-FAMILY: Courier New">DeleteData( ParametersCollection parameters )<br>    {<br>        </span><span style="FONT-SIZE: 10pt; COLOR: #008000; FONT-FAMILY: Courier New">/*<br>            TODO<br>            Solo la classe "reale" Customer conosce il sistema<br>            per persistere/manipolare i propri dati<br>        */<br>    </span><span style="FONT-SIZE: 10pt; COLOR: #000000; FONT-FAMILY: Courier New">}<br>}<br></span></div>
<span><strong>Persistence 
Layer<br></strong>E' lo strato 
che si occupa effettivamente di persistere ( Insert Update e Delete ) i 
dati, anche qui un esempio è meglio di mille parole: </span><br>
<div style="BORDER-RIGHT: black 1px solid; PADDING-RIGHT: 5px; BORDER-TOP: black 1px solid; PADDING-LEFT: 5px; PADDING-BOTTOM: 5px; BORDER-LEFT: black 1px solid; PADDING-TOP: 5px; BORDER-BOTTOM: black 1px solid; BACKGROUND-COLOR: gainsboro"><span style="FONT-SIZE: 10pt; COLOR: #008000; FONT-FAMILY: Courier New">//<br>// ASSEMBLY<br>// Topics.Common.Persistence.dll<br>//<br><br></span><span style="FONT-SIZE: 10pt; COLOR: #0000ff; FONT-FAMILY: Courier New">public sealed class </span><span style="FONT-SIZE: 10pt; COLOR: #000000; FONT-FAMILY: Courier New">PersistanceEngine<br>{<br>    </span><span style="FONT-SIZE: 10pt; COLOR: #0000ff; FONT-FAMILY: Courier New">private </span><span style="FONT-SIZE: 10pt; COLOR: #000000; FONT-FAMILY: Courier New">PersistanceEngine()<br>    {<br>    <br>    }<br><br>    </span><span style="FONT-SIZE: 10pt; COLOR: #0000ff; FONT-FAMILY: Courier New">private static </span><span style="FONT-SIZE: 10pt; COLOR: #000000; FONT-FAMILY: Courier New">PersistanceEngine _engine;<br>    <br>    </span><span style="FONT-SIZE: 10pt; COLOR: #008000; FONT-FAMILY: Courier New">/*<br>        Singleton<br>    */<br>    </span><span style="FONT-SIZE: 10pt; COLOR: #0000ff; FONT-FAMILY: Courier New">public static </span><span style="FONT-SIZE: 10pt; COLOR: #000000; FONT-FAMILY: Courier New">PersistencaEngine Engine<br>    {<br>        </span><span style="FONT-SIZE: 10pt; COLOR: #0000ff; FONT-FAMILY: Courier New">get<br>        </span><span style="FONT-SIZE: 10pt; COLOR: #000000; FONT-FAMILY: Courier New">{<br>            </span><span style="FONT-SIZE: 10pt; COLOR: #0000ff; FONT-FAMILY: Courier New">if</span><span style="FONT-SIZE: 10pt; COLOR: #000000; FONT-FAMILY: Courier New">( _engine == </span><span style="FONT-SIZE: 10pt; COLOR: #0000ff; FONT-FAMILY: Courier New">null </span><span style="FONT-SIZE: 10pt; COLOR: #000000; FONT-FAMILY: Courier New">)<br>            {<br>                _engine = </span><span style="FONT-SIZE: 10pt; COLOR: #0000ff; FONT-FAMILY: Courier New">new </span><span style="FONT-SIZE: 10pt; COLOR: #000000; FONT-FAMILY: Courier New">PersistanceEngine();<br>            }<br>            <br>            </span><span style="FONT-SIZE: 10pt; COLOR: #0000ff; FONT-FAMILY: Courier New">return </span><span style="FONT-SIZE: 10pt; COLOR: #000000; FONT-FAMILY: Courier New">_engine;<br>        }<br>    }<br>    <br>    </span><span style="FONT-SIZE: 10pt; COLOR: #0000ff; FONT-FAMILY: Courier New">private </span><span style="FONT-SIZE: 10pt; COLOR: #000000; FONT-FAMILY: Courier New">MyCustomerPersistance _myCustomers<br>    </span><span style="FONT-SIZE: 10pt; COLOR: #0000ff; FONT-FAMILY: Courier New">public </span><span style="FONT-SIZE: 10pt; COLOR: #000000; FONT-FAMILY: Courier New">MyCustomerPersistance MyCustomers<br>    {<br>        </span><span style="FONT-SIZE: 10pt; COLOR: #0000ff; FONT-FAMILY: Courier New">get<br>        </span><span style="FONT-SIZE: 10pt; COLOR: #000000; FONT-FAMILY: Courier New">{<br>            </span><span style="FONT-SIZE: 10pt; COLOR: #0000ff; FONT-FAMILY: Courier New">if</span><span style="FONT-SIZE: 10pt; COLOR: #000000; FONT-FAMILY: Courier New">( </span><span style="FONT-SIZE: 10pt; COLOR: #0000ff; FONT-FAMILY: Courier New">this</span><span style="FONT-SIZE: 10pt; COLOR: #000000; FONT-FAMILY: Courier New">._myCustomers == </span><span style="FONT-SIZE: 10pt; COLOR: #0000ff; FONT-FAMILY: Courier New">null </span><span style="FONT-SIZE: 10pt; COLOR: #000000; FONT-FAMILY: Courier New">)<br>            {<br>                </span><span style="FONT-SIZE: 10pt; COLOR: #0000ff; FONT-FAMILY: Courier New">this</span><span style="FONT-SIZE: 10pt; COLOR: #000000; FONT-FAMILY: Courier New">._myCustomers = MyCustomerPersistance.CreateInstance();<br>            }<br>            <br>            </span><span style="FONT-SIZE: 10pt; COLOR: #0000ff; FONT-FAMILY: Courier New">return this</span><span style="FONT-SIZE: 10pt; COLOR: #000000; FONT-FAMILY: Courier New">._myCustomers;<br>        }<br>    }<br>}<br><br></span><span style="FONT-SIZE: 10pt; COLOR: #0000ff; FONT-FAMILY: Courier New">public abstract class </span><span style="FONT-SIZE: 10pt; COLOR: #000000; FONT-FAMILY: Courier New">MyCustomerPersistance<br>{<br>    </span><span style="FONT-SIZE: 10pt; COLOR: #0000ff; FONT-FAMILY: Courier New">public static </span><span style="FONT-SIZE: 10pt; COLOR: #000000; FONT-FAMILY: Courier New">MyCustomerPersistance CreateInstance()<br>    {<br>        </span><span style="FONT-SIZE: 10pt; COLOR: #008000; FONT-FAMILY: Courier New">/*<br>            OMISSIS<br>            Legge da file .config quale tipo di<br>            Persistance debba istanziare e da quale<br>            assembly, trami Activator.CreateInstance( ... )<br>            inizializza la classe "reale" corretta<br>        */<br>    </span><span style="FONT-SIZE: 10pt; COLOR: #000000; FONT-FAMILY: Courier New">}<br>    <br>    </span><span style="FONT-SIZE: 10pt; COLOR: #0000ff; FONT-FAMILY: Courier New">public abstract void </span><span style="FONT-SIZE: 10pt; COLOR: #000000; FONT-FAMILY: Courier New">Update( ParametersCollection parameters );<br>    </span><span style="FONT-SIZE: 10pt; COLOR: #0000ff; FONT-FAMILY: Courier New">public abstract void </span><span style="FONT-SIZE: 10pt; COLOR: #000000; FONT-FAMILY: Courier New">Insert( ParametersCollection parameters );<br>    </span><span style="FONT-SIZE: 10pt; COLOR: #0000ff; FONT-FAMILY: Courier New">public abstract void </span><span style="FONT-SIZE: 10pt; COLOR: #000000; FONT-FAMILY: Courier New">Delete( ParametersCollection parameters );<br>}<br><br></span><span style="FONT-SIZE: 10pt; COLOR: #008000; FONT-FAMILY: Courier New">//<br>// ASSEMBLY<br>// Topics.MyApplication.SqlPersistence.dll<br>//<br><br></span><span style="FONT-SIZE: 10pt; COLOR: #0000ff; FONT-FAMILY: Courier New">public class </span><span style="FONT-SIZE: 10pt; COLOR: #000000; FONT-FAMILY: Courier New">MyCustomerSqlPersistance : MyCustomerPersistance<br>{<br>    </span><span style="FONT-SIZE: 10pt; COLOR: #0000ff; FONT-FAMILY: Courier New">public override void </span><span style="FONT-SIZE: 10pt; COLOR: #000000; FONT-FAMILY: Courier New">Update( ParametersCollection parameters )<br>    {<br>        </span><span style="FONT-SIZE: 10pt; COLOR: #008000; FONT-FAMILY: Courier New">//Salva su db via StoredProcedure<br>    </span><span style="FONT-SIZE: 10pt; COLOR: #000000; FONT-FAMILY: Courier New">}<br>    <br>    </span><span style="FONT-SIZE: 10pt; COLOR: #0000ff; FONT-FAMILY: Courier New">public override void </span><span style="FONT-SIZE: 10pt; COLOR: #000000; FONT-FAMILY: Courier New">Insert( ParametersCollection parameters )<br>    {<br>        </span><span style="FONT-SIZE: 10pt; COLOR: #008000; FONT-FAMILY: Courier New">//Salva su db via StoredProcedure<br>    </span><span style="FONT-SIZE: 10pt; COLOR: #000000; FONT-FAMILY: Courier New">}<br>    <br>    </span><span style="FONT-SIZE: 10pt; COLOR: #0000ff; FONT-FAMILY: Courier New">public override void </span><span style="FONT-SIZE: 10pt; COLOR: #000000; FONT-FAMILY: Courier New">Delete( ParametersCollection parameters )<br>    {<br>        </span><span style="FONT-SIZE: 10pt; COLOR: #008000; FONT-FAMILY: Courier New">//Cancella da db via StoredProcedure<br>    </span><span style="FONT-SIZE: 10pt; COLOR: #000000; FONT-FAMILY: Courier New">}<br>}<br></span></div>
<span>Quindi sistemando la ns classe MyCustomer nello strato di 
business i metodi InsertData, UpdateData e DeleteData avranno tutti un semplice 
corpo del tipo</span><br>
<div style="BORDER-RIGHT: black 1px solid; PADDING-RIGHT: 5px; BORDER-TOP: black 1px solid; PADDING-LEFT: 5px; PADDING-BOTTOM: 5px; BORDER-LEFT: black 1px solid; PADDING-TOP: 5px; BORDER-BOTTOM: black 1px solid; BACKGROUND-COLOR: gainsboro"><span style="FONT-SIZE: 10pt; COLOR: #0000ff; FONT-FAMILY: Courier New">protected override void </span><span style="FONT-SIZE: 10pt; COLOR: #000000; FONT-FAMILY: Courier New">InsertData( ParametersCollection parameters )<br>{<br>    PersistanceEngine.Engine.MyCustomers.Insert( parameters );<br>}<br><br></span><span style="FONT-SIZE: 10pt; COLOR: #0000ff; FONT-FAMILY: Courier New">protected override void </span><span style="FONT-SIZE: 10pt; COLOR: #000000; FONT-FAMILY: Courier New">UpdateData( ParametersCollection parameters )<br>{<br>    PersistencaEngine.Engine.MyCustomers.Update( parameters );<br>}<br><br></span><span style="FONT-SIZE: 10pt; COLOR: #0000ff; FONT-FAMILY: Courier New">protected override void </span><span style="FONT-SIZE: 10pt; COLOR: #000000; FONT-FAMILY: Courier New">DeleteData( ParametersCollection parameters )<br>{<br>    PersistanceEngine.Engine.MyCustomers.Delete( parameters );<br>}<br></span></div>
<span>In questo modo il domain layer accede ad un'interfaccia astratta e non ha la 
più "<em>pallida idea</em>" (come è giusto che sia) di quale sia la reale 
implementazione dello strato di <u>Persistance</u>. Questo porta un ulteriore vantaggio siccome 
lo strato di persistenza viene istanziato dinamicamente tramite 
informazioni prese da un file di configurazione è possibile creare un nuovo 
strato di persistenza in un nuovo assembly copiarlo nella directory 
"<em>bin</em>     
         
            
          
" dell'applicazione modificare opportunemente il file di configurazione e 
cambiare radicalmente il comportamento dell'applicazione senza che quest'ultima 
se ne accorga e soprattutto senza ricompilare.</span><br>
<span>"Fine prima parte"</span><br>
<span style="FONT-STYLE: italic">
.m<br>
-------------------<br>
Have a nice day
<br>
</span>