---
layout: post
title: WIF, LocalSTS and multiple applications on localhost
date: '2012-10-23T09:10:00.000+02:00'
author: Mauro Servienti
tags:
- Software Mason
- ACS
- Azure
- Identity
modified_time: '2012-10-23T09:10:00.332+02:00'
blogger_id: tag:blogger.com,1999:blog-6511237790974218081.post-6440026848885349200
blogger_orig_url: http://milestone.topics.it/2012/10/wif-localsts-and-multiple-applications.html
---

<p>Web developers tend to develop more than one application at a time…Mauro…have you discovered the hot water?</p> <p>If in our web application we are leveraging the power of <a href="http://msdn.microsoft.com/en-us/security/aa570351.aspx" target="_blank">Windows Identity Foundation</a>, and maybe of the <a href="https://www.windowsazure.com/en-us/develop/net/how-to-guides/access-control/" target="_blank">Windows Azure ACS</a>, we end up using the powerful “<a href="http://visualstudiogallery.msdn.microsoft.com/e21bf653-dfe1-4d81-b3d3-795cb104066e" target="_blank">Identity and Access</a>” Visual Studio extension to manage the WIF configuration and as soon as we discover the LocalSTS, that comes with the extension, we perform a standing ovation and round trip of the house running on knees :-)</p> <p>The problem we can face is that since everything, every web application we are developing, is running on localhost we and up with a mess due to cookies from different web sites, and thus with different authentication tokens, flowing all around in all web applications we are working on.</p> <p><strong>Set the cookie path, Luke…</strong></p> <p>The solution is trivially easy:</p> <blockquote> <div id="codeSnippetWrapper"><pre id="codeSnippet" style="border-top-style: none; overflow: visible; font-size: 8pt; border-left-style: none; font-family: 'Courier New', courier, monospace; border-bottom-style: none; color: black; padding-bottom: 0px; direction: ltr; text-align: left; padding-top: 0px; border-right-style: none; padding-left: 0px; margin: 0em; line-height: 12pt; padding-right: 0px; width: 100%; background-color: #f4f4f4"><span style="color: #0000ff">&lt;</span><span style="color: #800000">system.identityModel</span><span style="color: #0000ff">&gt;</span><br>  <span style="color: #0000ff">&lt;</span><span style="color: #800000">identityConfiguration</span><span style="color: #0000ff">&gt;</span><br>    <span style="color: #0000ff">&lt;</span><span style="color: #800000">audienceUris</span><span style="color: #0000ff">&gt;</span><br>      <span style="color: #0000ff">&lt;</span><span style="color: #800000">add</span> <span style="color: #ff0000">value</span><span style="color: #0000ff">="https://localhost/myWebApplication/"</span> <span style="color: #0000ff">/&gt;</span><br>    <span style="color: #0000ff">&lt;/</span><span style="color: #800000">audienceUris</span><span style="color: #0000ff">&gt;</span><br>    <span style="color: #0000ff">&lt;</span><span style="color: #800000">issuerNameRegistry</span> <span style="color: #ff0000">type</span><span style="color: #0000ff">="System.IdentityModel.Tokens.ConfigurationBasedIssuerNameRegistry, <br>                              System.IdentityModel, Version=4.0.0.0, <br>                              Culture=neutral, PublicKeyToken=b77a5c561934e089"</span><span style="color: #0000ff">&gt;</span><br>      <span style="color: #0000ff">&lt;</span><span style="color: #800000">trustedIssuers</span><span style="color: #0000ff">&gt;</span><br>        <span style="color: #0000ff">&lt;</span><span style="color: #800000">add</span> <span style="color: #ff0000">thumbprint</span><span style="color: #0000ff">="9B74CB2F320F7AAFC156E1252270B1DC01EF40D0"</span> <span style="color: #ff0000">name</span><span style="color: #0000ff">="LocalSTS"</span> <span style="color: #0000ff">/&gt;</span><br>      <span style="color: #0000ff">&lt;/</span><span style="color: #800000">trustedIssuers</span><span style="color: #0000ff">&gt;</span><br>    <span style="color: #0000ff">&lt;/</span><span style="color: #800000">issuerNameRegistry</span><span style="color: #0000ff">&gt;</span><br>    <span style="color: #0000ff">&lt;</span><span style="color: #800000">certificateValidation</span> <span style="color: #ff0000">certificateValidationMode</span><span style="color: #0000ff">="None"</span> <span style="color: #0000ff">/&gt;</span><br>  <span style="color: #0000ff">&lt;/</span><span style="color: #800000">identityConfiguration</span><span style="color: #0000ff">&gt;</span><br><span style="color: #0000ff">&lt;/</span><span style="color: #800000">system.identityModel</span><span style="color: #0000ff">&gt;</span><br><span style="color: #0000ff">&lt;</span><span style="color: #800000">system.identityModel.services</span><span style="color: #0000ff">&gt;</span><br>  <span style="color: #0000ff">&lt;</span><span style="color: #800000">federationConfiguration</span><span style="color: #0000ff">&gt;</span><br>    <span style="color: #0000ff">&lt;</span><span style="color: #800000">cookieHandler</span> <span style="color: #ff0000">requireSsl</span><span style="color: #0000ff">="false"</span> <font style="background-color: #ffff00"><span style="color: #ff0000">path</span><span style="color: #0000ff">="/myWebApplication"</span></font> <span style="color: #0000ff">/&gt;</span><br>    <span style="color: #0000ff">&lt;</span><span style="color: #800000">wsFederation</span> <span style="color: #ff0000">passiveRedirectEnabled</span><span style="color: #0000ff">="true"</span> <br>                  <span style="color: #ff0000">issuer</span><span style="color: #0000ff">="http://localhost:14342/wsFederationSTS/Issue"</span> <br>                  <span style="color: #ff0000">realm</span><span style="color: #0000ff">="https://localhost/myWebApplication/"</span> <br>                  <span style="color: #ff0000">reply</span><span style="color: #0000ff">="https://localhost/myWebApplication/"</span> <span style="color: #ff0000">requireHttps</span><span style="color: #0000ff">="false"</span> <span style="color: #0000ff">/&gt;</span><br>  <span style="color: #0000ff">&lt;/</span><span style="color: #800000">federationConfiguration</span><span style="color: #0000ff">&gt;</span><br><span style="color: #0000ff">&lt;/</span><span style="color: #800000">system.identityModel.services</span><span style="color: #0000ff">&gt;</span></pre><br></div></blockquote>
<p>in order to avoid “cookie confusion” is it enough to set the path attribute of the cookieHanlder element.</p>
<p>.m</p>  