---
layout: post
title: '[TFS.eX] Lavorare offline: il source control'
date: '2007-07-05T10:13:00.000+02:00'
author: Mauro Servienti
tags:
- Team Foundation Server
modified_time: '2012-01-26T11:53:46.747+01:00'
blogger_id: tag:blogger.com,1999:blog-6511237790974218081.post-197901018588302480
blogger_orig_url: http://milestone.topics.it/2007/07/tfsex-lavorare-offline-il-source.html
permalink: /2007/07/tfsex-lavorare-offline-il-source.html
---

<span>Prosegue la mia intensa esperienza con Team Foundation Server, se va avanti così tra un po' uno dei <a href="http://blogs.ugidotnet.com/raffaele" target="_blank">miei</a> <a href="http://blogs.ugidotnet.org/lbarbieri" target="_blank">mentori</a> mi definisce "TFS Addicted" ;-)</span><br> <span>Facendo il consulente sono quasi sempre offline vuoi perchè:</span><br> <ul> <li>Il cliente per policy non mi da accesso alla rete;  <li>il cliente mi da accesso alla rete (internet) ma blocca le VPN quindi non accedo a quello che mi serve della rete dell'ufficio;  <li>L'UMTS di Vodafone è un furto legalizzato ;-)  <li>La rete dell'uffico, raramente ma succede, è giù...</li></li></li></li></ul> <span>Queste motivazioni, ce ne sono probabilmente altre, rendono necessario avere un buon, anzi ottimo, supporto per il lavoro offline.</span><br> <span>Vi ho già parlato dell'<a href="http://blogs.ugidotnet.org/topics/archive/2007/07/02/84231.aspx" target="_blank">uso che si può fare di Groove</a> quindi non vi tedierò oltre anche perchè la configurazione è di Groove è di una semplicità disarmante, mentre per la parte server il <a href="http://blogs.msdn.com/briankel/archive/2007/04/14/Configuring-Visual-Studio-2005-Team-Foundation-Server-with-Windows-SharePoint-Services-3.0.aspx" target="_blank">white paper</a> che ho linkato è esaustivo.</span><br> <span>Oggi ho approcciato invece la necessità di avere a disposizione offline il Source Control, e direte be mi sembra il minimo....si certo ma non è detto che sia una cosa scontata</span><br> <span><u><em>SourceControl</em></u></span><br> <span>Questa è l'area che per ora fornisce il supporto più raw al lavoro offline, il team explorer non offre nessuna funzionalità per il lavoro offline e ci sono una serie di trick da mettere in pista per cercare almeno di lavorare sereni:</span><br> <ul> <li>Disabilitare da registro una malefica impostazione di Visual Studio che fa si che all'apertura l'IDE cerchi di connettersi sempre a TFS:  <span><em>[HKEY_CURRENT_USER\Software\Microsoft\VisualStudio\8.0\TeamFoundation]<br>"AutoLoadServer"=dword:00000000<br></em><em><br></em>La modifica del registro è a vostro rischio e pericolo ;-)</span><br></li></ul> <span>fatto questo sarà necessario connettersi manualmente al TFS, operazione che comunque avviene in automatico se cerchiamo di aprire una solution sotto Source Control.</span><br> <span>E qui troviamo le prime carenze, all'apertura della solution, se siamo off-line, non ci viene chiesto se vogliamo lavorare off-line o meno ma ci vengono ritornati un po' di errori di connessione e poi una form che ci chiede se vogliamo lavorare temporaneamente senza source control o se vogliamo rimuovere i binding con il TFS... naturalmente  la scelta deve ricadere sulla prima opzione ;-)</span><br> <span>Fatto questo lavoriamo normalmente, quasi come se fossimo connessi, non avremo più le dialog per il check-out ma in fase di salvataggio l'IDE ci informerà che il file (se era in check-in) è in sola lettura e se vogliamo sovrascriverlo, diciamo di si.</span><br> <ul> <li>Una volta che siamo nuovamente connessi alla rete e il TFS è raggiungibile riapriamo la solution su cui abbiamo lavorato off-line. per sincronizzare le modifiche eseguite off-line utilizziamo un tool da riga di comando (compreso nei Power Tool di TFS):<br><br>TFPT.exe online /deletes /exclude:Obj,Bin,*.CodeAnalysisLog.xml,*.lastcodeanalysissucceeded,*.suo,*.user,*.bak,*.temp,*.tmp<br><br>Eseguendolo nella directory in cui c'è la solution su cui abbiamo lavorato il power tool esguirà tutti i check-out e le altre operazioni al fine di <u>replicare</u> sul TFS quello che abbiamo fatto. Ho sottolineato replicare perchè è fondamentale capire che il tool riesegue i passi come se li avessimo fatti noi on-line quindi nella history del changeset ci ritroveremo tutto, con gli orari un po' sballati ma comunque nella sequenza corretta</li></ul> <span>Due note molto importanti:</span><br> <ol> <li>Prima di eseguire qualsisasi cosa il tool vi mostra una bella dialog con l'elenco delle operazioni che farà, da li potete modificare quello che volete;</li> <li>Dopo che ha eseguito tutte le operazioni siete sempre e comunque in check-out quindi nulla è ancora sul server e questo è un'ulteriore paracadute fondamentale;</li></ol> <span>Un'ultima nota: potete includere il tool negli "External Commands" di Visual Studio, se lo fate ricordatevi di <u>non spuntare</u> la check box "Use Output window" perchè altrimenti la prima dialog di conferma ve la perdete...</span><br> <span>.m</span><br>
