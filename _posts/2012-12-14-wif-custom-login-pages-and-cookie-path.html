---
layout: post
title: WIF custom login pages and cookie path…
date: '2012-12-14T09:14:00.000+01:00'
author: Mauro Servienti
tags:
- Software Mason
- Identity
modified_time: '2012-12-14T09:14:00.522+01:00'
blogger_id: tag:blogger.com,1999:blog-6511237790974218081.post-8258566116934757111
blogger_orig_url: http://milestone.topics.it/2012/12/wif-custom-login-pages-and-cookie-path.html
---

<p>…do not try this at home…well do not try this anywhere :-)</p> <p>Today I lost half of the day dealing with a nasty and horrible error, on a staging environment, trying to host <a href="http://www.windowsazure.com/" target="_blank">Azure</a> login pages locally instead that on the Azure ACS portal.</p> <p>It was not working, even if it should be really, really trivial to setup. After dealing with the trace recorded by fiddler for a couple of hours I realized that the whole problem is related to the WIF configuration of the web application:</p> <blockquote> <div id="codeSnippetWrapper"><pre id="codeSnippet" style="border-top-style: none; overflow: visible; font-size: 8pt; border-left-style: none; font-family: 'Courier New', courier, monospace; border-bottom-style: none; color: black; padding-bottom: 0px; direction: ltr; text-align: left; padding-top: 0px; border-right-style: none; padding-left: 0px; margin: 0em; line-height: 12pt; padding-right: 0px; width: 100%; background-color: #f4f4f4"><span style="color: #0000ff">&lt;</span><span style="color: #800000">system.identityModel</span><span style="color: #0000ff">&gt;</span><br>    <span style="color: #0000ff">&lt;</span><span style="color: #800000">identityConfiguration</span><span style="color: #0000ff">&gt;</span><br>        <span style="color: #0000ff">&lt;</span><span style="color: #800000">audienceUris</span><span style="color: #0000ff">&gt;</span><br>            <span style="color: #0000ff">&lt;</span><span style="color: #800000">add</span> <span style="color: #ff0000">value</span><span style="color: #0000ff">="https://localhost/MyWebApp/"</span> <span style="color: #0000ff">/&gt;</span><br>        <span style="color: #0000ff">&lt;/</span><span style="color: #800000">audienceUris</span><span style="color: #0000ff">&gt;</span><br>        <span style="color: #0000ff">&lt;</span><span style="color: #800000">issuerNameRegistry</span> <span style="color: #ff0000">type</span><span style="color: #0000ff">="System.IdentityModel.Tokens.ConfigurationBasedIssuerNameRegistry, System.IdentityModel, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089"</span><span style="color: #0000ff">&gt;</span><br>            <span style="color: #0000ff">&lt;</span><span style="color: #800000">trustedIssuers</span><span style="color: #0000ff">&gt;</span><br>                <span style="color: #0000ff">&lt;</span><span style="color: #800000">add</span> <span style="color: #ff0000">thumbprint</span><span style="color: #0000ff">="---"</span> <span style="color: #ff0000">name</span><span style="color: #0000ff">="---"</span> <span style="color: #0000ff">/&gt;</span><br>            <span style="color: #0000ff">&lt;/</span><span style="color: #800000">trustedIssuers</span><span style="color: #0000ff">&gt;</span><br>        <span style="color: #0000ff">&lt;/</span><span style="color: #800000">issuerNameRegistry</span><span style="color: #0000ff">&gt;</span><br>        <span style="color: #0000ff">&lt;</span><span style="color: #800000">certificateValidation</span> <span style="color: #ff0000">certificateValidationMode</span><span style="color: #0000ff">="None"</span> <span style="color: #0000ff">/&gt;</span><br>    <span style="color: #0000ff">&lt;/</span><span style="color: #800000">identityConfiguration</span><span style="color: #0000ff">&gt;</span><br><span style="color: #0000ff">&lt;/</span><span style="color: #800000">system.identityModel</span><span style="color: #0000ff">&gt;</span><br><span style="color: #0000ff">&lt;</span><span style="color: #800000">system.identityModel.services</span><span style="color: #0000ff">&gt;</span><br>    <span style="color: #0000ff">&lt;</span><span style="color: #800000">federationConfiguration</span><span style="color: #0000ff">&gt;</span><br>        <font style="background-color: #ffff00"><span style="color: #0000ff">&lt;</span><span style="color: #800000">cookieHandler</span> <span style="color: #ff0000">requireSsl</span><span style="color: #0000ff">="false"</span> <span style="color: #ff0000">path</span><span style="color: #0000ff">="/MyWebApp"</span> <span style="color: #0000ff">/&gt;</span><br></font>        <span style="color: #0000ff">&lt;</span><span style="color: #800000">wsFederation</span> <span style="color: #ff0000">passiveRedirectEnabled</span><span style="color: #0000ff">="true"</span> <span style="color: #ff0000">issuer</span><span style="color: #0000ff">="http://----/wsFederationSTS/Issue"</span> <span style="color: #ff0000">realm</span><span style="color: #0000ff">="https://localhost/MyWebApp/"</span> <span style="color: #ff0000">requireHttps</span><span style="color: #0000ff">="false"</span> <span style="color: #0000ff">/&gt;</span><br>    <span style="color: #0000ff">&lt;/</span><span style="color: #800000">federationConfiguration</span><span style="color: #0000ff">&gt;</span><br><span style="color: #0000ff">&lt;/</span><span style="color: #800000">system.identityModel.services</span><span style="color: #0000ff">&gt;</span></pre><br></div></blockquote>
<p>Removing the “path” attribute from the “cookieHandler” element solved the problem immediately.</p>
<p>Developer advised… :-)</p>
<p>.m</p>  