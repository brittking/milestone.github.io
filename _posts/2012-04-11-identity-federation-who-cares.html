---
layout: post
title: 'Identity Federation: who cares?'
date: '2012-04-11T22:49:00.001+02:00'
author: Mauro Servienti
tags:
- Security
- Identity
modified_time: '2012-04-11T22:49:26.103+02:00'
thumbnail: http://lh5.ggpht.com/-0ePTKVk3K3A/T4XuQQf2FhI/AAAAAAAAB-M/E4JtJxbYDpY/s72-c/image_thumb%25255B78%25255D.png?imgmax=800
blogger_id: tag:blogger.com,1999:blog-6511237790974218081.post-7126442394708128444
blogger_orig_url: http://milestone.topics.it/2012/04/identity-federation-who-cares.html
permalink: /2012/04/identity-federation-who-cares.html
---

<p>Today I <a href="https://twitter.com/#!/mauroservienti">twitted</a> something like:</p> <blockquote> <p>Mauro vs. ADFS + trusted custom identity provider: 1 - 0 :-) tomorrow will be harder :-)</p></blockquote> <p>And my dear friend <a href="https://twitter.com/#!/bitbreaker">Igor</a> replied something like:</p> <blockquote> <p>I’m really curious to know the usage scenario of ADFS</p></blockquote> <p><strong>What does “Identity” mean?</strong></p> <p>Identity is a really simple concept that we face day by day in our life, each time we meet a friend we immediately recognize him, or her, given a set of well known criteria: face, voice, behavior, etc.…</p> <p>We own the set of criteria that let us recognize our friends, but what happens when we meet someone we have never met before and that claims to be a specific person?</p> <p><strong>Identity Providers</strong></p> <p>We obviously need to rely on someone we trust, we can ask to the unknown party the identity card (with a photo ID, a first name and a last name) and since we trust the issuer od the identity card we can trust the person that claims to a specific person.</p> <p><strong>So far and so good…but…</strong></p> <p>What happens when we are in a foreign country and someone asks us about our identity? we can provide our own passport (with photo ID, first name, last name and issuer country)…but why the relying party should trust our passport? basically because she trusts her own government that itself trusts our government that is the issuer of the identity.</p> <p>The relying party government and our government are federated by a trust relationship, this is identity federation :-)</p> <p><strong>So what?</strong></p> <p>Don’t you see the big picture? Let’s say that we work for an international shipment provider, the company delegates a lot of the work to partners outside of the company domain, but these partners need to have access to information secured behind the company domain based security infrastructure:</p> <p><a href="http://lh5.ggpht.com/-VOk84EDzRT0/T4XuPVyykPI/AAAAAAAAB-E/ppFqUXYC48I/s1600-h/image%25255B80%25255D.png"><img style="background-image: none; border-bottom: 0px; border-left: 0px; padding-left: 0px; padding-right: 0px; display: inline; border-top: 0px; border-right: 0px; padding-top: 0px" title="image" border="0" alt="image" src="http://lh5.ggpht.com/-0ePTKVk3K3A/T4XuQQf2FhI/AAAAAAAAB-M/E4JtJxbYDpY/image_thumb%25255B78%25255D.png?imgmax=800" width="428" height="184"></a></p> <p>But there is no way to have an account for the partner created in the company domain, can we “steal” some concepts from the above passport sample?</p> <ol> <li>One employee of one of the partners tries to access internal data;</li> <li>The internal security system asks the employee for credentials;</li> <ol> <li>obviously the partner employee credentials cannot be validated by the company domain controller;</li> <li>the partner employee go to its own security system, authenticates and asks for a security token (the passport);</li> <li>goes back to the company domain controller and presents the security token (the passport);</li> <li>since the company domain controller trusts the partner security system the company domain controller:</li> <ol> <li>goes back to the partner security system and verifies the validity of the issued token;</li> <li>asks to the partner security system a set of information (first name, last name, photo in other words “claims”) required by the company to allow the access;</li></ol></ol></ol> <p>We obtained that the security credentials of the partner employee are stored in one single place and are managed by the organization that owns those credentials.</p> <p>But…Active Directory does not provide all these features, so who is the orchestrator that can link together different security systems? (as you may have notice I’ve never said that the partner security system is Active Directory, too easy :-P)</p> <p><strong>Please welcome the <em>A.</em>ccess <em>C.</em>ontrol <em>S.</em>erver</strong></p> <p>The ACS in our scenario is something that can manage trust relationships between different security systems, is something that can translate the language spoken by Active Directory and the language spoken by the Asp.Net MembershipProvider into something common, that is based on a shared concept: claims.</p> <p>So what happens is that our shipment company installs Active Directory Federation Services (ADFS) and configure two different trusted claims provider:</p> <p><a href="http://lh5.ggpht.com/-OpmaXbUcf54/T4XuREXbtZI/AAAAAAAAB-U/D6i5BWu-oIk/s1600-h/image%25255B94%25255D.png"><img style="background-image: none; border-bottom: 0px; border-left: 0px; padding-left: 0px; padding-right: 0px; display: inline; border-top: 0px; border-right: 0px; padding-top: 0px" title="image" border="0" alt="image" src="http://lh5.ggpht.com/-ZY_qF5rG_Ak/T4XuTL1nMAI/AAAAAAAAB-c/_9v9BXnvb44/image_thumb%25255B90%25255D.png?imgmax=800" width="320" height="174"></a></p> <ul> <li>The “Active Directory” claims provider is the company internal Active Directory;</li> <li>The “Partner IdentityServer” is the external trusted IdentityProvider (in this case a custom Security Token Service and Identity Provider based on Asp.Net Membership);</li></ul> <p><strong>The last step</strong></p> <p>When an anonymous user tries to access the company internal application he is presented with the authentication procedure:</p> <p><a href="http://lh5.ggpht.com/-HfvLqXBXzUs/T4XuT3Lc4nI/AAAAAAAAB-k/02py8Axj-FY/s1600-h/image%25255B103%25255D.png"><img style="background-image: none; border-bottom: 0px; border-left: 0px; padding-left: 0px; padding-right: 0px; display: inline; border-top: 0px; border-right: 0px; padding-top: 0px" title="image" border="0" alt="image" src="http://lh6.ggpht.com/-7P9KYyQWUuU/T4XuVJkw7RI/AAAAAAAAB-o/-eMN-rskNrs/image_thumb%25255B97%25255D.png?imgmax=800" width="289" height="124"></a></p> <p>Where the use need to select the identity provider to use to start the authentication process.</p> <p>We miss two steps:</p> <ol> <li>the client application configuration;</li> <li>the ability to automatically determine the identity provider without exposing to anonymous users the list of the supported providers;</li></ol> <p>but those are for another story :-P</p> <p>.m</p>  
