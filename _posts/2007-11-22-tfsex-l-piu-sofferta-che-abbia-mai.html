---
layout: post
title: '[TFS.eX] L''installazione più sofferta che abbia mai fatto...'
date: '2007-11-22T16:53:00.000+01:00'
author: Mauro Servienti
tags:
- Team Foundation Server
modified_time: '2012-01-27T15:44:04.889+01:00'
blogger_id: tag:blogger.com,1999:blog-6511237790974218081.post-888625027585165426
blogger_orig_url: http://milestone.topics.it/2007/11/tfsex-l-piu-sofferta-che-abbia-mai.html
permalink: /2007/11/tfsex-l-piu-sofferta-che-abbia-mai.html
---

<span>Ma per fortuna è andata, ma vieni!!! <img alt="Open-mouthed" src="http://messenger.msn.com/MMM2006-04-19_17.00/Resource/emoticons/teeth_smile.gif"></span><br> <span>Andiamo per gradi, mi ricollego al <a href="http://blogs.ugidotnet.org/topics/archive/2007/11/22/tfs.ex-le-magagne-dellinstallazione.aspx" target="_blank">post di stamattina</a> e ne approfitto per dare una risposta estesa al commento di <a href="http://blogs.ugidotnet.org/lbarbieri" target="_blank">Lorenzo</a>.</span><br> <span>Dunque il post sui forum MSDN che discute il potenziale problema del Service pack 2 di Sql Server è questo: <a title="http://forums.microsoft.com/MSDN/ShowPost.aspx?PostID=2156159&SiteID=1" href="http://forums.microsoft.com/MSDN/ShowPost.aspx?PostID=2156159&SiteID=1">http://forums.microsoft.com/MSDN/ShowPost.aspx?PostID=2156159&SiteID=1</a></span><br> <span>Alla fine però il mio problema non era li, o meglio non solo.</span><br> <span>Ho dovuto disinstallare tutto e rimettere la macchina in uno stato consono, fate attenzione che la disinstallazione dei vari componenti non fa proprio tutto, ad esempio:</span><br> <ul> <li>la configurazione dei Reporting Services in IIS l'ho dovuta cancellare a manina;  </li><li>le cartelle di installazione di Sql Server le ho dovute cancellare a mano</li></ul> <span>Se non fate entrambe le operazioni un tentativo di reinstallare il tutto fallirà miseramente.<br>Ho quindi reinstallato nell'ordine:</span><br> <ul> <li>Sql Server 2005;  </li><li>Il <u>Service Pack 1</u> (e non il 2) si Sql;  </li><li>Windows SharePoint Services;  </li><li>Team Foundation Server  </li><li>Il Team Explorer  </li><li>Il Service Pack 1 di TFS (e previo update per il "TfsQuescience" o come diavolo si chiama...);</li></ul> <span>Le installazioni vanno a buon fine allora faccio un rapido test delle funzionalità e boom... non va un bel nulla.<br>Da Visual Studio mi becco solo ed esclusivamente una sfilza di Access Denied e la stessa cosa (HTTP403) accedendo direttamente ai servizi da IIS.</span><br> <span>Devo dire che a questo punto cominciano a rotearmi non poco <img alt="Baring teeth" src="http://messenger.msn.com/MMM2006-04-19_17.00/Resource/emoticons/48_48.gif">...soprattutto perchè la giornata voleva essere dedicata a tutt'altro... <img alt="Wink" src="http://messenger.msn.com/MMM2006-04-19_17.00/Resource/emoticons/wink_smile.gif"></span><br> <span>Allora mi armo di PowerShell e "Best Pratice Analyzer" (che trovate nei PowerTool di TFS) e faccio uno scan del server.. e mi becco una sfilza di errori di configurazione di IIS... mistero dei misteri, verifico ed effettivamente ogni sito e ogni virtual directory in IIS era impostata per bloccare tutti gli accessi al di fuori di quelli provenienti da localhost/127.0.0.1... ancora più mistero.. mai vista un'installazione di IIS che di default è configurata così...</span><br> <span>Va be mi armo di pazienza faccio passare a mano tutto e rimetto a posto le cose, faccio un bel "<em>iisreset</em>" e riprovo ad accere ai servizi, sempre da browser e adesso sembra andare tutto... ma... Visual Studio continua a lamentarsi e non mi fa accedere.</span><br> <span>Rifaccio girare Best Pratice Analyzer e continua a segnalarmi lo stesso problema, con la differenza che se prima me lo segnalava n volte adesso l'errore è uno solo... mi sono perso per strada qualcosa.</span><br> <span>Rifaccio il giro ed in effetti mi ero dimenticato di impostare anche la configurazione predefinita da cui prendono i nuovi siti creati in IIS, e attenzione attenzione quando applico le modifiche mi segnala che il sito di TFS, nonostante avessi apportato le modifiche a mano, non è allineato... decido di lasciar fare al tool e tutto va a posto adesso Visual Studio si connette <img alt="Open-mouthed" src="http://messenger.msn.com/MMM2006-04-19_17.00/Resource/emoticons/teeth_smile.gif">.</span><br> <span>Non soddisfatto però della cosa, visto l'andazzo della giornata la mia vocina <cit.> mi gridava: <em>non fidarti</em>..., e così ho fatto: apro Visual Studio mi connetto al TFS e:</span><br> <ul> <li>creo un Team Project di test... OK;  </li><li>Accedo al Source Control e carico dei file... OK;  </li><li>Faccio query sugli WorkItem... OK;  </li><li>Inserisco nuovi WorkItem... OK;  </li><li>Apro un report... BOOM <img alt="Baring teeth" src="http://messenger.msn.com/MMM2006-04-19_17.00/Resource/emoticons/48_48.gif">;</li></ul> <span>Ad una prima okkiata sembra che l'installazione di RS sia completamente andata alle cozze, ma non è così.<br>Faccio una rapida analisi dell'installazione e RS va che è un piacere ma i Report di TFS non ne no vogliono sapere di renderizzarsi... mancano pezzi, non trova le Aree o le Iterazioni o entrambi.... insomma comportamenti tutto tranne che facilmenti tracciabili.</span><br> <span>Dopo un po' di smanettamenti e qualche migliaia di PageViews su Google trovo qualcuno che ha un problema simile... il suggerimento è un laconico rebuild dei cubi olap:</span><br> <span><em>setupwarehouse -o -s ServerName -d TFSWarehouse -c warehouseschema.xml -a TFSServiceAccount -ra TFSReportAccount</em></span><br> <span>Speranzoso lancio il comando, poi vado tra gli web service di TFS e invoco il rebuild:<br><a href="http://localhost:8080/Warehouse/v1.0/warehousecontroller.asmx?op=Run">http://localhost:8080/Warehouse/v1.0/warehousecontroller.asmx?op=Run</a></span><br> <span>Tutto va a buon fine ma le cose peggiorano... <img alt="Open-mouthed" src="http://messenger.msn.com/MMM2006-04-19_17.00/Resource/emoticons/teeth_smile.gif">, non avevo dubbi, del resto me lo sentivo...<br>Succede che adesso i report non si aprono più del tutto, ma si schiantano con un bell'errore che dice che non è possibile processare il cubo Team System perchè manca un non ben noto "<em>IterationParam</em>".</span><br> <span>Faccio salire nuovamente le stastiche di Google e giungo alla conclusione che potrebbe essere un problema di Regional Settings e collation di Sql Server, <em>mistero della fede <cit.></em>.</span><br> <span>Ricomincio a studiare il problema e alla fine (dopo un paio d'ore) scopro che:</span><br> <ul> <li>i Regional Settings del Server non erano proprio messi come si deve..., devo imparare a controllare meglio le configurazioni fatte dagli altri;  </li><li>Li metto a posto... e lo faccio per tutti gli utenti di TFS (Reports e Service)  </li><li>Lancio il seguente script Sql sul db di TFSWarehouse:  <span>DELETE FROM [TfsWarehouse].[dbo].[Today]<br>UPDATE [TfsWarehouse].[dbo].[Date]<br>    SET [Year] = NULL,<br>    [YearString] = NULL,<br>    [Month] = NULL,<br>    [MonthString] = NULL,<br>    [Month of Year] = NULL,<br>    [Week] = NULL,<br>    [WeekString] = NULL,<br>    [Week of Year] = NULL,<br>    [Date] = NULL,<br>    [Day of Year] = NULL,<br>    [Day of Month] = NULL,<br>    [Day of Week] = NULL  </span><br><span>Sembra che il problema possa essere, dovuto ai regional settings sbagliati, nel modo in cui Sql memorizza le date </span><br> </li><li>Faccio un bel iisreset, il centesimo della giornata;  </li><li>Riprovo e boom non cambia nulla</li></ul> <span>Alla fine trovo un altro post che fa più o meno la stessa cosa di "<em>setupwarehouse</em>" di cui ho parlato prima ma consiglia prima di lanciare il comando di cancellare a mano il db in Analysis Service. faccio il tutto e alla fine il report compare correttamente.</span><br> <span>Soddisfatto vado verso quel della palestra <img alt="Open-mouthed" src="http://messenger.msn.com/MMM2006-04-19_17.00/Resource/emoticons/teeth_smile.gif">, direi che la pagnotta in un modo o nell'altro me la sono guadagnata anche oggi</span><br> <span>.m</span><br>
